<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EMPORIO 2026 - Live Board</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #ffffff;
            min-height: 100vh;
            padding: 8px;
            font-size: 16px;
        }

        .layout {
            display: grid;
            grid-template-columns: 260px 1fr 300px;
            gap: 10px;
            max-width: 100%;
            margin: 0 auto;
            height: calc(100vh - 16px);
        }

        /* HEADER */
        .header {
            background: #000000;
            color: #ffffff;
            padding: 8px 20px;
            text-align: center;
            margin-bottom: 10px;
            border: 2px solid #000000;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
        }
        .header h1 { font-size: 1.2em; margin-bottom: 0; }
        .header p { font-size: 0.85em; opacity: 0.7; }

        /* SESSION INFO */
        .session-info {
            background: #000000;
            color: #ffffff;
            padding: 10px;
            text-align: center;
            margin-bottom: 10px;
            border: 2px solid #000000;
            display: flex;
            justify-content: space-around;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }
        .session-label, .market-clock, .market-status { font-size: 1.2em; font-weight: bold; }
        .market-status.open { color: #4ade80; }
        .market-status.closing { color: #fbbf24; }
        .market-status.closed { color: #f87171; }

        /* CONNECTION STATUS */
        .connection-bar {
            position: fixed;
            top: 0; left: 0; right: 0;
            padding: 6px 16px;
            font-size: 0.8em;
            font-weight: bold;
            text-align: center;
            z-index: 9999;
            transition: all 0.3s;
        }
        .connection-bar.connected { background: #f0fdf4; color: #16a34a; }
        .connection-bar.waiting { background: #fef3c7; color: #d97706; }
        body { padding-top: 30px; }
        .layout { height: calc(100vh - 38px); }

        /* LEADERBOARD */
        .leaderboard {
            background: #ffffff;
            border: 2px solid #000000;
            padding: 15px;
            overflow-y: auto;
        }
        .leaderboard-title {
            font-size: 1.4em;
            font-weight: bold;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #000000;
        }
        .team-card {
            background: #f9f9f9;
            border: 2px solid #000000;
            padding: 12px;
            margin-bottom: 10px;
            transition: all 0.3s;
        }
        .team-card.rank-1 { background: #fff4e6; border: 3px solid #000000; }
        .team-rank { font-size: 1.5em; font-weight: bold; float: right; }
        .team-name { font-weight: bold; font-size: 1.1em; margin-bottom: 8px; }
        .team-stats { font-size: 0.85em; font-family: 'Courier New', monospace; line-height: 1.6; }
        .team-networth {
            font-size: 1.1em; font-weight: bold; margin-top: 8px;
            padding-top: 8px; border-top: 1px solid #000000;
        }

        /* INDEX CARD */
        .index-card {
            background: #fff4e6;
            border: 3px solid #000000;
            padding: 12px;
            margin-bottom: 15px;
            box-shadow: 4px 4px 0 #000000;
        }

        /* MAIN CONTENT */
        .main-content { overflow-y: auto; }

        /* STOCK GRID */
        .stock-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }
        .stock-card {
            background: #ffffff;
            border: 2px solid #000000;
            padding: 15px;
            box-shadow: 4px 4px 0 #000000;
            transition: all 0.3s;
        }
        .stock-card:hover { transform: translate(-2px, -2px); box-shadow: 6px 6px 0 #000000; }
        .stock-card.flash { animation: flashCard 0.6s; }
        @keyframes flashCard {
            0%, 100% { background: #ffffff; transform: scale(1); }
            50% { background: #f0f0f0; transform: scale(1.02); }
        }
        .mini-chart-container {
            margin: 8px 0; height: 55px; position: relative;
            border: 1px solid #e5e5e5; background: #fafafa;
        }
        .mini-chart { width: 100%; height: 100%; }
        .company-name { font-size: 1.15em; font-weight: bold; }
        .stock-symbol { font-size: 0.85em; color: #666; }
        .current-price { font-size: 1.8em; font-weight: bold; font-family: 'Courier New', monospace; margin: 6px 0; }
        .price-change { font-size: 1em; font-weight: bold; font-family: 'Courier New', monospace; }
        .price-change.positive { color: #16a34a; }
        .price-change.negative { color: #dc2626; }
        .stats {
            display: grid; grid-template-columns: repeat(2, 1fr);
            gap: 8px; margin-top: 8px; padding-top: 8px;
            border-top: 1px solid #e5e5e5; font-size: 0.85em;
        }
        .stat-label { color: #666; }
        .stat-value { font-weight: bold; font-family: 'Courier New', monospace; }

        /* TEAM HOLDINGS TABLE */
        .team-holdings-section {
            background: #ffffff;
            border: 2px solid #000000;
            padding: 15px;
            margin-top: 12px;
        }
        .holdings-title {
            font-size: 1.2em; font-weight: bold; margin-bottom: 10px;
            padding-bottom: 8px; border-bottom: 2px solid #000000;
        }
        .holdings-table {
            width: 100%; border-collapse: collapse;
            font-size: 0.85em; font-family: 'Courier New', monospace;
        }
        .holdings-table th {
            background: #000000; color: #ffffff; padding: 7px 8px;
            text-align: center; font-weight: bold;
        }
        .holdings-table th:first-child { text-align: left; }
        .holdings-table td { padding: 6px 8px; text-align: center; border-bottom: 1px solid #e5e5e5; }
        .holdings-table td:first-child { text-align: left; font-weight: bold; }
        .holdings-table tr:nth-child(even) { background: #f9f9f9; }
        .holdings-zero { color: #ccc; }

        /* NEWS SIDEBAR */
        .news-sidebar {
            background: #ffffff;
            border: 2px solid #000000;
            padding: 10px;
            overflow-y: auto;
        }
        .news-title {
            font-size: 1.1em; font-weight: bold; margin-bottom: 8px;
            padding-bottom: 6px; border-bottom: 2px solid #000000;
        }
        .news-item {
            background: #f9f9f9; border: 1px solid #e0e0e0;
            padding: 7px 9px; margin-bottom: 6px; font-size: 0.78em;
        }
        .news-company { font-weight: bold; font-size: 0.95em; margin-bottom: 2px; }
        .news-text { line-height: 1.35; margin-bottom: 2px; }
        .news-time { font-size: 0.75em; color: #999; }

        /* FLASH NEWS OVERLAY */
        .flash-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); backdrop-filter: blur(10px);
            display: none; align-items: center; justify-content: center; z-index: 9999;
        }
        .flash-overlay.show { display: flex; }
        .flash-news {
            background: #ffffff; border: 4px solid #000000;
            padding: 40px; max-width: 800px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.4);
            animation: slideUpNews 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        @keyframes slideUpNews {
            from { transform: translateY(30px) scale(0.95); opacity: 0; }
            to { transform: translateY(0) scale(1); opacity: 1; }
        }
        .flash-company { font-size: 2em; font-weight: bold; margin-bottom: 20px; }
        .flash-text { font-size: 1.2em; line-height: 1.8; }
    </style>
</head>
<body>
    <div class="connection-bar waiting" id="connectionBar">‚è≥ Waiting for Admin to connect...</div>

    <div class="layout">
        <!-- LEADERBOARD -->
        <div class="leaderboard">
            <div class="leaderboard-title">üèÜ Leaderboard</div>
            <div id="indexFundCard"></div>
            <div id="leaderboardContent"></div>
        </div>

        <!-- MAIN CONTENT -->
        <div class="main-content">
            <div class="header">
                <h1>EMPORIO 2026</h1>
                <span style="opacity:0.4;">|</span>
                <p>Joseph's Stock Exchange</p>
            </div>

            <div class="session-info">
                <div class="session-label">Session: <span id="sessionName">1</span></div>
                <div class="market-clock" id="marketClock">09:15</div>
                <div class="market-status open" id="marketStatus">MARKET OPEN</div>
            </div>

            <div class="stock-grid" id="stockGrid"></div>

            <div class="team-holdings-section">
                <div class="holdings-title">üìã Team Holdings</div>
                <div id="teamHoldingsTable"></div>
            </div>
        </div>

        <!-- NEWS SIDEBAR -->
        <div class="news-sidebar">
            <div class="news-title">üì∞ News Feed</div>
            <div id="newsHistory"></div>
        </div>
    </div>

    <!-- Flash News -->
    <div class="flash-overlay" id="flashOverlay">
        <div class="flash-news">
            <div class="flash-company" id="flashCompany"></div>
            <div class="flash-text" id="flashText"></div>
        </div>
    </div>

    <script>
        // ==================== LOCAL DATA (defaults, overwritten by admin sync) ====================
        const stocks = [
            { name: 'Adani Ports', symbol: 'ADANIPORTS', price: 850.00, open: 850.00, volume: '2.5M', priceHistory: [850.00] },
            { name: 'L&T', symbol: 'LT', price: 3400.00, open: 3400.00, volume: '3.2M', priceHistory: [3400.00] },
            { name: 'JSW Steel', symbol: 'JSWSTEEL', price: 820.00, open: 820.00, volume: '8.5M', priceHistory: [820.00] },
            { name: 'ONGC', symbol: 'ONGC', price: 260.00, open: 260.00, volume: '12.8M', priceHistory: [260.00] },
            { name: 'TCS', symbol: 'TCS', price: 4100.00, open: 4100.00, volume: '1.8M', priceHistory: [4100.00] },
            { name: 'Titan', symbol: 'TITAN', price: 3600.00, open: 3600.00, volume: '2.8M', priceHistory: [3600.00] },
            { name: 'CEAT', symbol: 'CEATLTD', price: 2800.00, open: 2800.00, volume: '680K', priceHistory: [2800.00] },
            { name: 'State Bank of India', symbol: 'SBIN', price: 720.00, open: 720.00, volume: '18.5M', priceHistory: [720.00] }
        ];

        let indexFund = {
            name: 'NIFTY 50', symbol: 'NIFTY50', value: 21000, open: 21000,
            history: [21000], volume: '500M'
        };

        let teams = {};
        let newsHistory = [];
        let currentSession = 1;

        // ==================== BROADCAST CHANNEL ====================
        const channel = new BroadcastChannel('emporio-2026');

        channel.onmessage = (e) => {
            const msg = e.data;

            if (msg.type === 'full-sync' || msg.type === 'state-update') {
                // Update stocks
                if (msg.stocks) {
                    msg.stocks.forEach(s => {
                        const local = stocks.find(ls => ls.symbol === s.symbol);
                        if (local) {
                            local.price = s.price;
                            local.open = s.open;
                            local.priceHistory = s.priceHistory || local.priceHistory;
                            local.priceHistory.push(s.price);
                            if (local.priceHistory.length > 100) local.priceHistory.shift();
                        }
                    });
                }
                // Update index
                if (msg.indexFund) {
                    indexFund.value = msg.indexFund.value;
                    indexFund.open = msg.indexFund.open;
                    indexFund.name = msg.indexFund.name || indexFund.name;
                    indexFund.history.push(msg.indexFund.value);
                    if (indexFund.history.length > 100) indexFund.history.shift();
                }
                // Update teams
                if (msg.teams) teams = msg.teams;
                // Update session
                if (msg.currentSession) {
                    currentSession = msg.currentSession;
                    document.getElementById('sessionName').textContent = currentSession;
                }
                // Update clock
                if (msg.clock) document.getElementById('marketClock').textContent = msg.clock;
                if (msg.marketStatus) {
                    const el = document.getElementById('marketStatus');
                    el.textContent = msg.marketStatus.text;
                    el.className = 'market-status ' + msg.marketStatus.class;
                }

                // Re-render everything
                renderAllStockCards();
                updateIndexCard();
                updateLeaderboard();
                renderTeamHoldings();

                // Connection status
                document.getElementById('connectionBar').textContent = 'üü¢ Connected to Admin';
                document.getElementById('connectionBar').className = 'connection-bar connected';
            }

            if (msg.type === 'news-history') {
                newsHistory = msg.newsHistory || [];
                renderNewsHistory();
            }

            if (msg.type === 'flash-news') {
                showFlashNews(msg.company, msg.text);
            }

            if (msg.type === 'session-reset') {
                if (msg.stocks) {
                    msg.stocks.forEach(s => {
                        const local = stocks.find(ls => ls.symbol === s.symbol);
                        if (local) {
                            local.price = s.price;
                            local.open = s.open;
                            local.priceHistory = [s.price];
                        }
                    });
                }
                if (msg.indexFund) {
                    indexFund.value = msg.indexFund.value;
                    indexFund.open = msg.indexFund.open;
                    indexFund.history = [msg.indexFund.value];
                }
                if (msg.teams) teams = msg.teams;
                currentSession = msg.currentSession || 1;
                document.getElementById('sessionName').textContent = currentSession;
                newsHistory = [];
                renderNewsHistory();
                renderAllStockCards();
                updateIndexCard();
                updateLeaderboard();
                renderTeamHoldings();
            }
        };

        // Request a sync on load
        channel.postMessage({ type: 'request-sync' });

        // ==================== HELPERS ====================
        function formatINR(num) {
            const numStr = Math.round(num).toString();
            const lastThree = numStr.substring(numStr.length - 3);
            const otherNumbers = numStr.substring(0, numStr.length - 3);
            if (otherNumbers !== '') {
                return otherNumbers.replace(/\B(?=(\d{2})+(?!\d))/g, ",") + "," + lastThree;
            }
            return lastThree;
        }

        // ==================== RENDERING ====================
        function renderAllStockCards() {
            const grid = document.getElementById('stockGrid');
            // Only build DOM once, then update
            if (grid.children.length === 0) {
                // Index card
                const idxCard = document.createElement('div');
                idxCard.className = 'stock-card index-card';
                idxCard.id = 'stock-NIFTY50';
                grid.appendChild(idxCard);
                // Stock cards
                stocks.forEach(stock => {
                    const card = document.createElement('div');
                    card.className = 'stock-card';
                    card.id = `stock-${stock.symbol}`;
                    grid.appendChild(card);
                });
            }
            // Update index card in grid
            updateIndexStockCard();
            // Update each stock
            stocks.forEach(stock => updateStockCard(stock.symbol));
        }

        function updateStockCard(symbol) {
            const stock = stocks.find(s => s.symbol === symbol);
            if (!stock) return;
            const card = document.getElementById(`stock-${symbol}`);
            if (!card) return;

            const change = stock.price - stock.open;
            const pct = ((change / stock.open) * 100).toFixed(2);
            const isPos = change >= 0;

            card.innerHTML = `
                <div class="company-name">${stock.name}</div>
                <div class="stock-symbol">${stock.symbol}</div>
                <div class="current-price">‚Çπ${stock.price.toFixed(2)}</div>
                <div class="price-change ${isPos ? 'positive' : 'negative'}">
                    ${isPos ? '‚ñ≤' : '‚ñº'} ‚Çπ${Math.abs(change).toFixed(2)} (${isPos ? '+' : ''}${pct}%)
                </div>
                <div class="mini-chart-container">
                    <canvas class="mini-chart" id="chart-${stock.symbol}"></canvas>
                </div>
                <div class="stats">
                    <div><span class="stat-label">Open:</span> <span class="stat-value">‚Çπ${stock.open.toFixed(2)}</span></div>
                    <div><span class="stat-label">Volume:</span> <span class="stat-value">${stock.volume}</span></div>
                </div>
            `;
            drawMiniChart(symbol);
            card.classList.add('flash');
            setTimeout(() => card.classList.remove('flash'), 500);
        }

        function updateIndexStockCard() {
            const card = document.getElementById('stock-NIFTY50');
            if (!card) return;
            const change = indexFund.value - indexFund.open;
            const pct = ((change / indexFund.open) * 100).toFixed(2);
            const isPos = change >= 0;

            card.innerHTML = `
                <div class="company-name">${indexFund.name}</div>
                <div class="stock-symbol">${indexFund.symbol}</div>
                <div class="current-price">‚Çπ${indexFund.value.toFixed(2)}</div>
                <div class="price-change ${isPos ? 'positive' : 'negative'}">
                    ${isPos ? '‚ñ≤' : '‚ñº'} ‚Çπ${Math.abs(change).toFixed(2)} (${isPos ? '+' : ''}${pct}%)
                </div>
                <div class="mini-chart-container">
                    <canvas class="mini-chart" id="chart-NIFTY50"></canvas>
                </div>
                <div class="stats">
                    <div><span class="stat-label">Open:</span> <span class="stat-value">‚Çπ${indexFund.open.toFixed(2)}</span></div>
                    <div><span class="stat-label">Volume:</span> <span class="stat-value">${indexFund.volume}</span></div>
                </div>
            `;
            drawIndexChart();
        }

        function updateIndexCard() {
            const change = indexFund.value - indexFund.open;
            const pct = ((change / indexFund.open) * 100).toFixed(2);
            const isPos = change >= 0;
            document.getElementById('indexFundCard').innerHTML = `
                <div class="index-card">
                    <div style="font-weight: bold; font-size: 1.1em; margin-bottom: 8px;">${indexFund.name}</div>
                    <div style="font-size: 1.5em; font-weight: bold; font-family: 'Courier New';">‚Çπ${indexFund.value.toFixed(2)}</div>
                    <div style="font-size: 0.9em; font-weight: bold; color: ${isPos ? '#16a34a' : '#dc2626'};">
                        ${isPos ? '‚ñ≤' : '‚ñº'} ‚Çπ${Math.abs(change).toFixed(2)} (${isPos ? '+' : ''}${pct}%)
                    </div>
                </div>
            `;
        }

        function calculateNetWorth(name) {
            const team = teams[name];
            if (!team) return 0;
            let total = team.cash;
            Object.entries(team.holdings).forEach(([sym, qty]) => {
                if (sym === 'NIFTY50') total += qty * indexFund.value;
                else {
                    const stock = stocks.find(s => s.symbol === sym);
                    if (stock) total += qty * stock.price;
                }
            });
            return total;
        }

        function updateLeaderboard() {
            const rankings = Object.keys(teams).map(name => ({
                name, netWorth: calculateNetWorth(name), cash: teams[name].cash
            })).sort((a, b) => b.netWorth - a.netWorth);

            const container = document.getElementById('leaderboardContent');
            container.innerHTML = '';

            rankings.forEach((team, idx) => {
                const card = document.createElement('div');
                card.className = `team-card ${idx === 0 ? 'rank-1' : ''}`;
                const holdings = team.netWorth - team.cash;
                card.innerHTML = `
                    <div class="team-rank">#${idx + 1}</div>
                    <div class="team-name">${team.name}</div>
                    <div class="team-stats">
                        Cash: ‚Çπ${formatINR(team.cash)}<br>
                        Holdings: ‚Çπ${formatINR(holdings)}
                    </div>
                    <div class="team-networth">‚Çπ${formatINR(team.netWorth)}</div>
                `;
                container.appendChild(card);
            });
        }

        function renderTeamHoldings() {
            const container = document.getElementById('teamHoldingsTable');
            if (!container) return;
            const teamNames = Object.keys(teams);
            if (teamNames.length === 0) { container.innerHTML = '<div style="color:#999;text-align:center;padding:20px;">Waiting for teams...</div>'; return; }
            const allSymbols = ['NIFTY50', ...stocks.map(s => s.symbol)];

            let html = '<table class="holdings-table"><thead><tr><th>Team</th>';
            allSymbols.forEach(sym => { html += `<th>${sym}</th>`; });
            html += '<th>Cash</th></tr></thead><tbody>';

            teamNames.forEach(name => {
                const team = teams[name];
                html += `<tr><td>${name}</td>`;
                allSymbols.forEach(sym => {
                    const qty = team.holdings[sym] || 0;
                    html += `<td class="${qty === 0 ? 'holdings-zero' : ''}">${qty}</td>`;
                });
                html += `<td>‚Çπ${formatINR(team.cash)}</td></tr>`;
            });
            html += '</tbody></table>';
            container.innerHTML = html;
        }

        function renderNewsHistory() {
            const container = document.getElementById('newsHistory');
            container.innerHTML = '';
            newsHistory.forEach(item => {
                const div = document.createElement('div');
                div.className = 'news-item';
                div.innerHTML = `
                    <div class="news-company">${item.company}</div>
                    <div class="news-text">${item.news}</div>
                    <div class="news-time">${item.time || ''}</div>
                `;
                container.appendChild(div);
            });
        }

        function showFlashNews(company, text) {
            document.getElementById('flashCompany').textContent = company;
            document.getElementById('flashText').textContent = text;
            document.getElementById('flashOverlay').classList.add('show');
            setTimeout(() => { document.getElementById('flashOverlay').classList.remove('show'); }, 2000);
        }

        // ==================== CHARTS ====================
        function drawMiniChart(symbol) {
            const stock = stocks.find(s => s.symbol === symbol);
            if (!stock) return;
            const canvas = document.getElementById(`chart-${symbol}`);
            if (!canvas) return;
            const ctx = canvas.getContext('2d');
            const width = canvas.width = canvas.offsetWidth;
            const height = canvas.height = canvas.offsetHeight;
            ctx.clearRect(0, 0, width, height);

            const history = stock.priceHistory;
            if (history.length < 2) return;
            const min = Math.min(...history); const max = Math.max(...history);
            const range = max - min || 1;
            const padding = range * 0.1;
            const chartMin = min - padding; const chartRange = (max + padding) - chartMin;

            const points = history.map((price, i) => ({
                x: (i / (history.length - 1)) * (width - 50),
                y: height - ((price - chartMin) / chartRange) * height
            }));

            const isPos = stock.price >= stock.open;
            const color = isPos ? '#16a34a' : '#dc2626';

            ctx.fillStyle = isPos ? 'rgba(22,163,74,0.08)' : 'rgba(220,38,38,0.08)';
            ctx.beginPath(); ctx.moveTo(points[0].x, height);
            points.forEach(p => ctx.lineTo(p.x, p.y));
            ctx.lineTo(points[points.length - 1].x, height); ctx.fill();

            ctx.strokeStyle = color; ctx.lineWidth = 1.5; ctx.beginPath();
            points.forEach((p, i) => i === 0 ? ctx.moveTo(p.x, p.y) : ctx.lineTo(p.x, p.y));
            ctx.stroke();

            const last = points[points.length - 1];
            ctx.fillStyle = color; ctx.font = 'bold 10px Courier';
            ctx.fillText(`‚Çπ${stock.price.toFixed(2)}`, width - 48, Math.max(12, Math.min(height - 4, last.y)));
        }

        function drawIndexChart() {
            const canvas = document.getElementById('chart-NIFTY50');
            if (!canvas) return;
            const ctx = canvas.getContext('2d');
            const width = canvas.width = canvas.offsetWidth;
            const height = canvas.height = canvas.offsetHeight;
            ctx.clearRect(0, 0, width, height);

            const history = indexFund.history;
            if (history.length < 2) return;
            const min = Math.min(...history); const max = Math.max(...history);
            const range = max - min || 1;
            const padding = range * 0.1;
            const chartMin = min - padding; const chartRange = (max + padding) - chartMin;

            const points = history.map((val, i) => ({
                x: (i / (history.length - 1)) * (width - 50),
                y: height - ((val - chartMin) / chartRange) * height
            }));

            const isPos = indexFund.value >= indexFund.open;
            const color = isPos ? '#16a34a' : '#dc2626';

            ctx.fillStyle = isPos ? 'rgba(22,163,74,0.08)' : 'rgba(220,38,38,0.08)';
            ctx.beginPath(); ctx.moveTo(points[0].x, height);
            points.forEach(p => ctx.lineTo(p.x, p.y));
            ctx.lineTo(points[points.length - 1].x, height); ctx.fill();

            ctx.strokeStyle = color; ctx.lineWidth = 1.5; ctx.beginPath();
            points.forEach((p, i) => i === 0 ? ctx.moveTo(p.x, p.y) : ctx.lineTo(p.x, p.y));
            ctx.stroke();

            const last = points[points.length - 1];
            ctx.fillStyle = color; ctx.font = 'bold 10px Courier';
            ctx.fillText(`‚Çπ${indexFund.value.toFixed(2)}`, width - 48, Math.max(12, Math.min(height - 4, last.y)));
        }

        // Initial render (will show defaults until admin connects)
        renderAllStockCards();
        updateIndexCard();
        updateLeaderboard();
        renderTeamHoldings();
    </script>
</body>
</html>
